{% if request.query.success %}
  <p style="color: green;">Form submitted successfully</p>
{% endif %}

{% if request.query.error %}
  <p style="color: red;">{{ request.query.error }}</p>
{% endif %}

<div id="form-error" style="display:none; color:red;"></div>

<form
 id="configuratorForm"
  method="post"
  action="/apps/configurator"
  enctype="multipart/form-data"
>
<h1 class="fill-designer-et">Please Fill the Designer Form.</h1>
<div class="section-spacingg">
  <div class="container container--xxs">
<div class="fieldset_et ">
  <div class="form-control_et">
  <input type="text" name="brand_name" placeholder="Brand Name" required>
<input type="hidden" name="shop_domain" value="kastesting.myshopify.com" />

</div>
  <div class="form-control_et grid_frome">
      <input type="text" name="bio" placeholder="Bio" required>
  <input type="text" name="category" placeholder="Category" required>
</div>
   <div class="form-control_et">
  <input type="text" name="phone" placeholder="Phone" required>
  </div>

<div class="form-control_et">
  <input type="text" name="contact_email" id="contact_email" placeholder="Contact email" required>
</div>

   <div class="form-control_filr">
 <label>Profile image</label>
  <input type="file" name="lookbook_file" accept=".pdf,.jpg,.png" >
</div>
  <div class="form-control_filr">
  <label>Line sheet PDF</label>
  <input type="file" name="linesheet_pdf" accept=".pdf" >
</div></div>
<div class="buttton_stn">
  <button class="button" type="submit" id="submitBtn">
    <span class="btn-text">Submit</span>
    <span class="loader" style="display:none;"></span>
  </button>
 
</div>
 </div>
 </div>
</form>

<div id="form-success" style="display:none; color:green;">
  Form submitted successfully
</div>
<style>
  .loader {
    width: 16px;
    height: 16px;
    border: 2px solid #fff;
    border-top: 2px solid #000;
    border-radius: 50%;
    display: inline-block;
    animation: spin 1s linear infinite;
    margin-left: 8px;
  }

  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
  .form-control_et input {
     width: 100%;
     border-radius: 0;
     border: 1px solid #CECECE;
     padding: 10.4px 12.8px;
     background: transparent;
}
.fieldset_et {
     display: grid;
     gap: 16px;
}
.form-control_et.grid_frome {
     display: grid;
     gap: 16px;
     grid-template-columns: 1fr 1fr;
}
.form-control_filr label {
     display: block;
     width: 100%;
}
.form-control_filr input {
     width: 100%;
     border-radius: 0;
     border: 1px solid #CECECE;
     padding: 10.4px 12.8px;
}
.buttton_stn button {
     width: 100%;
     border-radius: 0;
     border: 1px solid #CECECE;
     padding: 10.4px 12.8px;
     margin-top: 16px;
}
.shopify-section--main-customers-account .section-header.text-start {
  max-width: max-content;
  }
</style>


<script>
  const form = document.getElementById("configuratorForm");
  const submitBtn = document.getElementById("submitBtn");
  const spinner = submitBtn.querySelector(".loader");
  const successBox = document.getElementById("form-success");
  const errorBox = document.getElementById("form-error");

  form.addEventListener("submit", async function (e) {
    e.preventDefault();

    spinner.style.display = "inline-block";
    submitBtn.disabled = true;

    successBox.style.display = "none";
    errorBox.style.display = "none";

    try {
      const formData = new FormData(form);

      const res = await fetch("/apps/configurator", {
        method: "POST",
        body: formData
      });

      const result = await res.json();

      if (!res.ok || result.success === false) {
        throw new Error(result.error || "Submission failed");
      }

      successBox.style.display = "block";
      form.reset();

    } catch (err) {
      errorBox.textContent = err.message;
      errorBox.style.display = "block";

    } finally {
      // spinner OFF
      spinner.style.display = "none";
      submitBtn.disabled = false;
    }
  });
</script>



<script>
  // URL se email parameter nikaalne ke liye
  const urlParams = new URLSearchParams(window.location.search);
  const email = urlParams.get('email');

  // Agar email mila to input me auto fill karo
  if (email) {
    const emailInput = document.getElementById('contact_email');
    if (emailInput) {
      emailInput.value = email;
    }
  }
</script>


<script>
  const form = document.getElementById("configuratorForm");
  const successBox = document.getElementById("form-success");
  const errorBox = document.getElementById("form-error");

  form.addEventListener("submit", async function (e) {
    e.preventDefault();

    successBox.style.display = "none";
    errorBox.style.display = "none";

    const formData = new FormData(form);

    try {
      const response = await fetch("/apps/configurator", {
        method: "POST",
        body: formData
      });

      const result = await response.json();

      if (!response.ok || result.success === false) {
        throw new Error(result.error || "Submission failed");
      }

      successBox.style.display = "block";
      form.reset();
    } catch (error) {
      errorBox.textContent = error.message;
      errorBox.style.display = "block";
    }
  });
</script>

{% schema %}
{
  "name": "Configurator Form",
  "target": "section"
}
{% endschema %} 


